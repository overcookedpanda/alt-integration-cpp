#include <gtest/gtest.h>

#include <veriblock/blockchain/blockchain.hpp>

#include "mock/storage/block_repository_mock.hpp"
#include "veriblock/entities/btcblock.hpp"

using namespace VeriBlock;

template <typename Block>
struct BlockchainTest : public ::testing::Test {
  typename Blockchain<Block>::index_t bootstrap;

  std::shared_ptr<BlockRepositoryMock<Block>> repo;
  std::shared_ptr<Blockchain<Block>> blockchain;

  BlockchainTest() {
    repo = std::make_shared<BlockRepositoryMock<Block>>();
    blockchain = std::make_shared<Blockchain<Block>>(repo, bootstrap);
  };
};

static std::string BTCbootstraps =
    "0000402058123BFE576594FD7F351C7017699487A606E3A3C82F3F8E0A0100000000000020"
    "FC0FC66A5A52FF044AAD1B2C98AF9EFEDF57B21CBC452BD5027151D5DE86967F15335EFFFF"
    "001D78A75BDF,"
    "00000020BD39F4E20F7D249F9EAD54A0ADEA8091CD331D372FB4A01649BC03000000000013"
    "6616467BFE6C16BBB2F03FE8CBE4C66273B80B8B366B34CC6DFF90D9F6C70E471A335EFFFF"
    "001DA76973D7,"
    "00000020AF6EF65FBC6F632A07DC9694D782F2AC4E07D2590ED9E1F4915313000000000069"
    "E71CF9B6CCDE0D2EE953C8A514A8BFFC79C09FDDA8C9E01DBA74814B0C3EC8FB1E335EFFFF"
    "001DD0A96479,"
    "0000002050F16E121C98D79F87BCBE891A9D35CE0DB9CB8E5D89F01E021497B20000000082"
    "678C0BECA7B4B7824A5857C28F3C7E999CCE38C7279C2043949FA11CB798463423335EDE55"
    "011A5C9A25FA,"
    "0000C020270D478CAD83D07FBCB7371963268FE8783D6B33C2E08CE73D01000000000000F8"
    "DE7C06CAD82FD88C592F38FCB801874F690F7DE1D32E32555EBD522B4D148CEF27335EFFFF"
    "001D6CEE09AA,"
    "00008020BD3D056673920B8AC66EA8087D53B1E4D668B30AC398EA885DAE000000000000FB"
    "93EA5B2EF949D9293C7A5BEFB98C0FE38600E3838398C14614FC3464B8C8B70828335EDE55"
    "011A5C66C703,"
    "00E0FF3F1A80EF9DEDFE56B696B4B2D91D9983F73AC4ECFBDD4195BF3A010000000000006A"
    "9EB947182760E55ADD876F58ABC130DC89D34D394D0BED18783E5A2AD7A41B172A335EDE55"
    "011A8BAE4DD2,"
    "0000C020575D9D2FA3ADBA78806E56D949A125DACCBCC8DA578AD35A0D0000000000000034"
    "CCEF4FBC0BF2F07C59EE60AE813FE73134BFB28CB53CA3682153E46A78AB76D42E335EFFFF"
    "001DB571D50B,"
    "00008020856A5D24B04D165108DD6B587B4D74F746A0EAB4A2FF2F67F9DD010000000000AE"
    "201201FA1B3243F971784FB7BB4A39B575B4D02B713E784EBEC72AE1CF58E95832335EDE55"
    "011AB8DC5CDA,"
    "00000020458573DAAF82C973B916E88802B3D8DF2C5627D7A62442677B000000000000000B"
    "559ADD4751B8320C928E4EFA2769B0A442D732869A463D299B62A34B415E141037335EFFFF"
    "001D86B1AAED,"
    "00000020A147F667D7FCB4D8ED6F03E0FB1EB8AD17986713F686ABE7528C29000000000094"
    "4CB7BDE853FEE5A0AB615551526888BD1F6CA48888A53FA1558790811752B9A73A335EDE55"
    "011ADD60DFA3,"
    "000000207E9BDCAAFB7814B0CA7BC4710A19F451993F50727892973212000000000000006D"
    "CB626A8522DA970364A310B2303520F019124F9C9B45AF5C985F260FCB9816713F335EFFFF"
    "001D02903733,"
    "000000201C4193BAA116C3A8E724BE4FC22B0A7BFDC60B070ADB08CC5F342500000000003C"
    "F4F7ED117C72F798C69DA355C156E20261C2BA565E6CE52322443BAEC8F4454742335EDE55"
    "011AE7492919,"
    "00000020FA069C8F340442CF786D99786F94EBF0FCD63D87813E22C84300000000000000D2"
    "BBA7E0BC59B609E77B03505131998F364169950CECD3DAE982ABBE0C66AD379645335EDE55"
    "011A9C74640B,"
    "0000002069862B4DBD76E47473E22134E600C5FD08BEB0BB1CA5CCF339010000000000005F"
    "7A45456137C160D4AC554C56942E345566AC0BC77607E0AF0BCD1EB6F73F374D4A335EFFFF"
    "001DFFB98CA7,"
    "00E0002085B25C8474C2165D1919F3D95D25F71C6A5F02912D3B3DC88CE602000000000098"
    "C87D07C2325044F5F901BBC2827913969EEC909616CA15D70D711AD777F9F49B4B335EDE55"
    "011A7F3290F4";

TYPED_TEST_SUITE_P(BlockchainTest);

TYPED_TEST_P(BlockchainTest, BootstrapWorks) {}

REGISTER_TYPED_TEST_SUITE_P(BlockchainTest, BootstrapWorks);

INSTANTIATE_TYPED_TEST_SUITE_P(Generic, BlockchainTest, BtcBlock);